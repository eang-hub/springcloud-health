<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  border-radius: 3px;
}

.markdown-body code:not(.highlight):not(.codehilite), .markdown-body samp {
  background-color: rgba(0,0,0,0.04);
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
}

.markdown-body .codehilite,
.markdown-body .highlight,
.markdown-body pre {
  border-radius: 3px;
}

.markdown-body :not(.highlight) > pre {
  background-color: #f7f7f7;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

.markdown-body diagram-div, .markdown-body div.uml-sequence-diagram, .markdown-body, div.uml-flowchart {
  overflow: auto;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#f7f7f7;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>11  å¼‚æ­¥ç½‘å…³ï¼šå¦‚ä½•åŸºäº Spring Cloud Gateway æ„å»º API ç½‘å…³ï¼Ÿ</title></head><body><article class="markdown-body"><p data-nodeid="685" class="">æˆ‘ä»¬çŸ¥é“åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åœ¨æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´æ¶è®¾ API ç½‘å…³ï¼Œæ¥æ»¡è¶³éœ€è¦æœåŠ¡è·¯ç”±å’Œæ§åˆ¶çš„å„ç§åœºæ™¯ã€‚åœ¨å‰é¢ä¸¤ä¸ªè¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº† Zuul ç½‘å…³çš„ä½¿ç”¨æ–¹å¼å’Œå®ç°åŸç†ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­ä»‹ç»å¦ä¸€æ¬¾ API ç½‘å…³ï¼Œå³ Spring Cloud Gatewayã€‚</p>

<h3 data-nodeid="686">Spring Cloud Gateway ç®€ä»‹</h3>

<p data-nodeid="687">Spring Cloud Gateway æ˜¯ Spring å®˜æ–¹è‡ªå·±å¼€å‘çš„ä¸€æ¬¾ API ç½‘å…³ã€‚åœ¨å…·ä½“å±•å¼€ä»‹ç» Spring Cloud Gateway ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¯¹å®ƒå’Œ Netflix Zuul åšä¸€ä¸ªå¯¹æ¯”ã€‚é€šè¿‡ä¸Šä¸€è¯¾æ—¶çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ Zuul çš„å®ç°åŸç†æ˜¯å¯¹ Servlet çš„ä¸€å±‚å°è£…ï¼Œé€šä¿¡æ¨¡å¼ä¸Šé‡‡ç”¨çš„æ˜¯é˜»å¡å¼ I/Oã€‚è€Œåœ¨æŠ€æœ¯ä½“ç³»ä¸Šï¼ŒSpring Cloud Gateway åŸºäºæœ€æ–°çš„ Spring 5 å’Œ Spring Boot 2ï¼Œä»¥åŠç”¨äºå“åº”å¼ç¼–ç¨‹çš„ Project Reactor æ¡†æ¶ï¼Œæä¾›çš„æ˜¯å“åº”å¼ã€éé˜»å¡å¼ I/O æ¨¡å‹ã€‚æ‰€ä»¥è¾ƒä¹‹ Netflix Zuulï¼Œ<strong data-nodeid="739">æ€§èƒ½ä¸Š</strong>Spring Cloud Gateway æ˜¾ç„¶è¦æ›´èƒœä¸€ç­¹ã€‚</p>

<p data-nodeid="688">å¦ä¸€æ–¹é¢ï¼Œ<strong data-nodeid="745">ä»åŠŸèƒ½ä¸Š</strong>ï¼ŒSpring Cloud Gateway ä¹Ÿæ¯” Zuul æ›´ä¸ºä¸°å¯Œã€‚é™¤äº†é€šç”¨çš„æœåŠ¡è·¯ç”±æœºåˆ¶ä¹‹å¤–ï¼ŒSpring Cloud Gateway è¿˜æ”¯æŒè¯·æ±‚é™æµç­‰é¢å‘æœåŠ¡å®¹é”™æ–¹é¢çš„åŠŸèƒ½ï¼ŒåŒæ ·ä¹Ÿèƒ½ä¸ Hystrix ç­‰æ¡†æ¶è¿›è¡Œè‰¯å¥½çš„é›†æˆã€‚</p>

<p data-nodeid="689">è®²åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æ—¢ç„¶æœ‰äº†æ€§èƒ½å’ŒåŠŸèƒ½éƒ½æ›´é«˜ä¸€ç­¹çš„ Spring Cloud Gatewayï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ä»‹ç» Zuul å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º Spring Cloud Gateway çš„æºç éå¸¸å¤æ‚ï¼Œå‡ºç°é—®é¢˜ä¸å®¹æ˜“æ’æŸ¥å’Œè§£å†³ã€‚è€Œ Zuul çš„ç¼–ç¨‹æ¨¡å‹å’Œåº•å±‚åŸç†éƒ½éå¸¸ç®€å•ï¼Œå¼€å‘è°ƒè¯•ä¸Šä¹Ÿå®¹æ˜“æŠŠæ¡ã€‚</p>

<p data-nodeid="690">è¦æƒ³åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¼•å…¥ Spring Cloud Gatewayï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„ Spring Boot åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ Maven ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–é¡¹ï¼š</p>

<pre class="lang-xml" data-nodeid="691"><code data-language="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>

<p data-nodeid="692">æŒ‰ç…§çº¦å®šï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡å‘½åä¸º gateway-serverï¼Œç„¶ååœ¨ä½œä¸º Bootstrap ç±»çš„ GatewayApplication ä¸Šæ·»åŠ  @EnableDiscoveryClient æ³¨è§£å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre class="lang-java" data-nodeid="693"><code data-language="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GatewayApplication</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SpringApplication.run(GatewayApplication.class, args);
&nbsp;&nbsp;&nbsp; }
}
</code></pre>

<h3 data-nodeid="694">Spring Cloud Gateway ä¸æœåŠ¡è·¯ç”±</h3>

<p data-nodeid="695">åœ¨å¼•å…¥ Spring Cloud Gateway ä¹‹åï¼Œæˆ‘ä»¬å…ˆé‡ç‚¹è®¨è®ºä¸€ä¸‹å®ƒä½œä¸º API ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå³æœåŠ¡è·¯ç”±ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åŒæ ·è¦å…ˆå¯¹ Spring Cloud Gateway çš„åŸºæœ¬æ¶æ„è¿›è¡Œä¸€ä¸ªåˆæ­¥çš„äº†è§£ã€‚</p>

<h4 data-nodeid="696">Spring Cloud Gateway åŸºæœ¬æ¶æ„</h4>

<p data-nodeid="697">Spring Cloud Gateway ä¸­çš„æ ¸å¿ƒæ¦‚å¿µæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è¿‡<strong data-nodeid="761">æ»¤å™¨ï¼ˆFilterï¼‰</strong>ï¼Œä¸€ä¸ªæ˜¯<strong data-nodeid="762">è°“è¯ï¼ˆPredicateï¼‰</strong>ã€‚Spring Cloud Gateway çš„æ•´ä½“æ¶æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p data-nodeid="698"><img src="https://s0.lgstatic.com/i/image/M00/64/30/Ciqc1F-X3WqATvJfAAGAafgQhSE126.png" alt="Lark20201027-164157.png" data-nodeid="765"></p>

<div data-nodeid="699"><p style="text-align:center">Spring Cloud Gateway åŸºæœ¬æ¶æ„å›¾</p></div>

<p data-nodeid="700">Spring Cloud Gateway ä¸­çš„è¿‡æ»¤å™¨å’Œ Zuul ä¸­çš„è¿‡æ»¤å™¨æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚å®ƒä»¬éƒ½å¯ä»¥ç”¨äºåœ¨å¤„ç† HTTP è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚æœ¬èº«ï¼ŒåŠå¯¹åº”å“åº”ç»“æœã€‚åŒºåˆ«åœ¨äºä¸¤è€…çš„ç±»å‹å’Œå®ç°æ–¹å¼ä¸åŒã€‚Spring Cloud Gateway çš„ç§ç±»éå¸¸ä¸°å¯Œï¼Œæˆ‘ä»¬åœ¨ä»Šå¤©çš„åç»­å†…å®¹ä¸­ä¼šæœ‰ä¸“é—¨ä¸»é¢˜å¯¹å…¶è¿›è¡Œè¯¦ç»†çš„å±•å¼€ã€‚</p>

<p data-nodeid="701">è€Œæ‰€è°“è°“è¯ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§åˆ¤æ–­æ¡ä»¶ï¼Œç”¨äºå°† HTTP è¯·æ±‚ä¸è·¯ç”±è¿›è¡ŒåŒ¹é…ã€‚Spring Cloud Gateway å†…ç½®äº†å¤§é‡çš„è°“è¯ç»„ä»¶ï¼Œå¯ä»¥åˆ†åˆ«å¯¹ HTTP è¯·æ±‚çš„æ¶ˆæ¯å¤´ã€è¯·æ±‚è·¯å¾„ç­‰å¸¸è§çš„è·¯ç”±åª’ä»‹è¿›è¡Œè‡ªåŠ¨åŒ¹é…ä»¥ä¾¿å†³å®šè·¯ç”±ç»“æœã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ— æ„å¯¹æ‰€æœ‰è°“è¯ä¸€ä¸€å±•å¼€ï¼Œä½ å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£åšè¿›ä¸€æ­¥å­¦ä¹ ã€‚</p>

<p data-nodeid="702">äº‹å®ä¸Šï¼Œé™¤äº†æŒ‡å®šæœåŠ¡çš„åç§°å’Œç›®æ ‡æœåŠ¡åœ°å€ä¹‹å¤–ï¼Œä½¿ç”¨ Spring Cloud Gateway æœ€ä¸»è¦çš„å¼€å‘å·¥ä½œå°±æ˜¯é…ç½®è°“è¯å’Œè¿‡æ»¤å™¨è§„åˆ™ï¼Œè®©æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹å§ã€‚</p>

<h4 data-nodeid="703">ä½¿ç”¨ Spring Cloud Gateway å®ç°è·¯ç”±</h4>

<p data-nodeid="704">ä¸ Zuul ä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡é…ç½®é¡¹æ¥è®¾ç½® Spring Cloud Gateway å¯¹ HTTP è¯·æ±‚çš„è·¯ç”±è¡Œä¸ºã€‚ä½†ä¸ Zuul ä¸åŒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Cloud Gateway å¹¶ä¸æ”¯æŒä¸æœåŠ¡å‘ç°æœºåˆ¶ä¹‹é—´çš„è‡ªåŠ¨é›†æˆã€‚æ‰€ä»¥ï¼Œä¸ºäº†å¯ç”¨è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®é¡¹ï¼š</p>

<pre class="lang-xml" data-nodeid="705"><code data-language="xml">spring:
  cloud:
    gateway:
&nbsp;     discovery:
&nbsp;&nbsp;      locator:
&nbsp;&nbsp;&nbsp;&nbsp;      enabled: true
</code></pre>

<p data-nodeid="706">ç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€æ¡å®Œæ•´è·¯ç”±é…ç½®çš„åŸºæœ¬ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<pre class="lang-xml" data-nodeid="707"><code data-language="xml">spring:
  cloud:
    gateway:
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;routes:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - id: testroute
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uri: lb://testservice
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; predicates:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Path=/test/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filters:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - PrefixPath=/prefix
</code></pre>

<p data-nodeid="708">åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ id é…ç½®é¡¹æŒ‡å®šäº†è¿™æ¡<strong data-nodeid="808">è·¯ç”±ä¿¡æ¯çš„ç¼–å·</strong>ï¼Œè¿™ä¸ªä¾‹å­ä¸­çš„â€œtestrouteâ€å°±èµ·äº†è¿™ä¸ªä½œç”¨ã€‚è€Œ uri é…ç½®é¡¹ä¸­çš„â€œlbâ€ä»£è¡¨<strong data-nodeid="809">è´Ÿè½½å‡è¡¡</strong>LoadBalanceï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è®¿é—® url æŒ‡å®šçš„æœåŠ¡åç§°æ—¶éœ€è¦<strong data-nodeid="810">é›†æˆè´Ÿè½½å‡è¡¡æœºåˆ¶</strong>ã€‚è¯·æ³¨æ„â€œlbâ€é…ç½®é¡¹ä¸­æ‰€æŒ‡å®šçš„æœåŠ¡åç§°åŒæ ·éœ€è¦ä¸ä¿å­˜åœ¨ Eureka ä¸­çš„æœåŠ¡åç§°<strong data-nodeid="811">å®Œå…¨ä¸€è‡´</strong>ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨äº†<strong data-nodeid="812">è°“è¯</strong>æ¥å¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œ<strong data-nodeid="813">åŒ¹é…</strong>ï¼Œè¿™é‡Œçš„â€œPath=/test/<strong data-nodeid="814">â€ä»£è¡¨æ‰€æœ‰ä»¥â€œ/testâ€å¼€å¤´çš„è¯·æ±‚éƒ½å°†è¢«è·¯ç”±åˆ°è¿™æ¡è·¯å¾„ä¸­ã€‚æœ€åæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª</strong>è¿‡æ»¤å™¨**ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯<strong data-nodeid="815">ä¸ºè·¯å¾„æ·»åŠ å‰ç¼€</strong>ï¼ˆPrefixï¼‰ï¼Œè¿™æ ·å½“è¯·æ±‚â€œ/test/â€æ—¶ï¼Œæœ€åè½¬å‘åˆ°ç›®æ ‡æœåŠ¡çš„è·¯å¾„å°†ä¼šå˜ä¸ºâ€œ/prefix/test/â€ã€‚</p>

<p data-nodeid="709">è®©æˆ‘ä»¬å›åˆ° SpringHealth æ¡ˆä¾‹ç³»ç»Ÿï¼ŒSpring Cloud Gateway ç½‘å…³æœåŠ¡ä¸­å®Œæ•´ç‰ˆçš„é…ç½®ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre class="lang-xml" data-nodeid="710"><code data-language="xml">server:
&nbsp; port: 5555

eureka:
&nbsp; instance:
&nbsp;&nbsp;&nbsp; preferIpAddress: true
&nbsp; client:
&nbsp;&nbsp;&nbsp; registerWithEureka: true
&nbsp;&nbsp;&nbsp; fetchRegistry: true
&nbsp;&nbsp;&nbsp; serviceUrl:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; defaultZone: http://localhost:8761/eureka/

spring:
&nbsp; cloud:
&nbsp;&nbsp;&nbsp; gateway:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; discovery:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; locator:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enabled: true
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; routes:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - id: userroute
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uri: lb://userservice
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; predicates:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Path=/user/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filters:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - RewritePath=/user/(?<span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>.*), /$\{path}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - id: deviceroute
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uri: lb://deviceservice
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; predicates:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Path=/device/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filters:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - RewritePath=/device/(?<span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>.*), /$\{path}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - id: interventionroute
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uri: lb://interventionservice
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; predicates:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Path=/intervention/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filters:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - RewritePath=/intervention/(?<span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>.*), /$\{path}
</code></pre>

<p data-nodeid="711">å°½ç®¡åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆä¸‰ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡æœåŠ¡çš„å®Œæ•´æ„å»ºã€‚ä½†ä»è®¾è®¡å’Œè§„åˆ’ä¸Šè®²ï¼Œå¯ä»¥å…ˆå¯¹æœåŠ¡è·¯ç”±è¿›è¡Œé…ç½®ã€‚åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº† Eureka æœåŠ¡çš„åœ°å€å¹¶å¯ç”¨äº†æœåŠ¡å‘ç°æœºåˆ¶ï¼Œç„¶åæ ¹æ® Eureka ä¿å­˜çš„æœåŠ¡åç§°å’Œåœ°å€å®šä¹‰äº†ä¸‰æ¡è·¯ç”±è§„åˆ™ï¼šuserrouteã€deviceroute å’Œ interventionroute åˆ†åˆ«å¯¹åº” user-serviceã€device-service å’Œ intervention-service è¿™ä¸‰ä¸ªå¾®æœåŠ¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡åœ¨å„ä¸ªæœåŠ¡åç§°å‰é¢åŠ ä¸Šâ€œlb://â€æ¥å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚</p>

<p data-nodeid="712">åŒæ—¶ï¼Œæˆ‘ä»¬åŒæ ·å¯¹è¯·æ±‚è·¯å¾„è®¾ç½®äº†è°“è¯ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªå¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œé‡å†™ï¼ˆRewriteï¼‰çš„<strong data-nodeid="823">è¿‡æ»¤å™¨</strong>ã€‚é€šå¸¸ï¼Œæ¯ä¸ªå¾®æœåŠ¡è‡ªèº«é€šè¿‡æ ¹è·¯å¾„â€œ/â€æ¥æš´éœ²æœåŠ¡ã€‚åŸºäºä»¥ä¸Šé…ç½®ï¼Œé€šè¿‡ Spring Cloud Gateway æš´éœ²å®ƒä»¬æ—¶ï¼Œåˆ™åˆ†åˆ«åœ¨è·¯å¾„ä¸Šæ·»åŠ äº†â€œ/userâ€â€œ/deviceâ€å’Œâ€œ/interventionâ€å‰ç¼€ã€‚è¿™ç§é‡å†™è¿‡æ»¤å™¨çš„æ•ˆæœå®é™…ä¸Šå’Œå‰é¢ä»‹ç»çš„å‰ç¼€è¿‡æ»¤å™¨æœ‰ç›¸åŒçš„æ•ˆæœã€‚</p>

<p data-nodeid="713">ä»¥ä¸Šé…ç½®é¡¹æ¯”è¾ƒå¸¸è§ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå¹¶æ­å»ºæ»¡è¶³è‡ªèº«éœ€æ±‚çš„ç½‘å…³æœåŠ¡ã€‚ç„¶åï¼Œåœ¨ Spring Cloud Gateway çš„æ•´ä¸ªåŠŸèƒ½ä½“ç³»ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤šå€¼å¾—æˆ‘ä»¬å»æŒ–æ˜çš„åœ°æ–¹ã€‚ä¸ Zuul ä¸€æ ·ï¼ŒSpring Cloud Gateway çš„<strong data-nodeid="833">æ‰©å±•æ€§</strong>ä¹Ÿä¸»è¦ä½“ç°åœ¨<strong data-nodeid="834">è¿‡æ»¤å™¨ç»„ä»¶</strong>ä¸­ã€‚</p>

<h3 data-nodeid="714">å‰–æ Spring Cloud Gateway ä¸­çš„è¿‡æ»¤å™¨</h3>

<p data-nodeid="715">é’ˆå¯¹è¿‡æ»¤å™¨ï¼ŒSpring Cloud Gateway æä¾›äº†ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼ˆGlobalFilterï¼‰çš„æ¦‚å¿µã€‚è¿™ä¸ªæ¦‚å¿µçš„åº”ç”¨å¯¹è±¡æ˜¯è·¯ç”±æœ¬èº«ã€‚å¦‚æœè¿‡æ»¤å™¨åªé’ˆå¯¹æŸä¸€ä¸ªè·¯ç”±ç”Ÿæ•ˆï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„è¿‡æ»¤å™¨ã€‚è€Œé‚£äº›å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨å°±æ˜¯å…¨å±€è¿‡æ»¤å™¨ã€‚Spring Cloud Gateway å†…ç½®äº†ä¸€å¤§æ‰¹è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬åŒæ ·æ— æ„å¯¹å®ƒä»¬ä¸€ä¸€å±•å¼€ï¼Œæ¯ä¸ªè¿‡æ»¤å™¨åœ¨å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰è¯¦ç»†çš„æè¿°ã€‚æˆ‘è¿™é‡Œä¸¾å‡ ä¸ªå¸¸è§çš„è¿‡æ»¤å™¨ä½¿ç”¨æ–¹æ³•ã€‚</p>

<p data-nodeid="716">æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°äº†å¯ä»¥ä½¿ç”¨å…¨å±€è¿‡æ»¤å™¨æ¥å¯¹æ‰€æœ‰ HTTP è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå…·ä½“åšæ³•æ˜¯å®ç° GlobalFilter æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<pre class="lang-java te-preview-highlight" data-nodeid="855"><code data-language="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JWTAuthFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GlobalFilter</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ServerHttpRequest.Builder builder = exchange.getRequest().mutate();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; builder.header(<span class="hljs-string">"Authorization"</span>,<span class="hljs-string">"JWTToken"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> chain.filter(exchange.mutate().request(builder.build()).build());
&nbsp;&nbsp;&nbsp; }
}
</code></pre>

<p data-nodeid="718">ä»¥ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å…¨å±€è¿‡æ»¤å™¨åœ¨æ‰€æœ‰çš„è¯·æ±‚ä¸­æ·»åŠ  Header çš„å®ç°æ–¹æ³•ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç»™æ‰€æœ‰ç»è¿‡ API ç½‘å…³çš„ HTTP è¯·æ±‚æ·»åŠ äº†ä¸€ä¸ªæ¶ˆæ¯å¤´ï¼Œç”¨æ¥è®¾ç½®ä¸ JWT Token ç›¸å…³çš„å®‰å…¨è®¤è¯ä¿¡æ¯ã€‚å…³äºå¾®æœåŠ¡çš„å®‰å…¨æ€§å’Œ JWT æˆ‘ä»¬ä¼šåœ¨ã€ŠæœåŠ¡è®¤è¯ï¼šå¦‚ä½•ä½¿ç”¨JWTå®ç°å®šåˆ¶åŒ–Tokenï¼Ÿã€‹è¯¾æ—¶è¿›è¡Œè¯¦ç»†å±•å¼€ã€‚</p>

<p data-nodeid="719">æ³¨æ„åˆ°è¿™é‡Œçš„ filter æ–¹æ³•è¿”å›äº†ä¸€ä¸ª Mono å¯¹è±¡ã€‚ä½ å¯èƒ½ä¼šé—®è¿™ä¸ª Mono å¯¹è±¡ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¿™æ˜¯åœ¨å“åº”å¼ç¼–ç¨‹æ¡†æ¶ Project Reactor ä¸­ä»£è¡¨å•ä¸ªè¿”å›å€¼çš„æµå¼å¯¹è±¡ã€‚å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¤æ‚çš„è¯é¢˜ï¼Œåœ¨æˆ‘ä»¬æ•´ä¸ª Spring å…¨å®¶æ¡¶è¯¾ç¨‹ä¸­ä¼šæœ‰ä¸“é¢˜è¿›è¡Œä»‹ç»ï¼Œç°åœ¨ä½ åªéœ€è¦æŒæ¡å¦‚ä½•ä½¿ç”¨å¸¸è§çš„ API æ¥æ„å»ºå…¨å±€è¿‡æ»¤å™¨çš„æ–¹æ³•ä»¥åŠæ•ˆæœã€‚</p>

<p data-nodeid="720">å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å›æƒ³åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­æåˆ°çš„ï¼ŒZuul æœ‰ preã€routeã€post å’Œ error è¿™å››ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œåˆ†åˆ«å¯¹åº”ä¸€ä¸ª HTTP è¯·æ±‚çš„ä¸åŒç”Ÿå‘½å‘¨æœŸã€‚åœ¨è¿™ç‚¹ä¸Šï¼ŒSpring Cloud Gateway ä¸ Zuul åœ¨è®¾è®¡æ€æƒ³ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå®ƒä¹Ÿæä¾›äº†å¯ç”¨äº pre å’Œ post ä¸¤ç§é˜¶æ®µçš„è¿‡æ»¤å™¨ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®åœºæ™¯æ¥æ„å»ºé’ˆå¯¹è¿™ä¸¤ä¸ªé˜¶æ®µçš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚</p>

<p data-nodeid="721">ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ª PostGatewayFilter çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬é¦–å…ˆç»§æ‰¿ä¸€ä¸ª AbstractGatewayFilterFactory ç±»ï¼Œç„¶åå¯ä»¥é€šè¿‡è¦†å†™ apply æ–¹æ³•æ¥æä¾›é’ˆå¯¹ ServerHttpResponse å¯¹è±¡çš„ä»»ä½•æ“ä½œï¼š</p>

<pre class="lang-java" data-nodeid="722"><code data-language="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostGatewayFilterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGatewayFilterFactory</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PostGatewayFilterFactory</span><span class="hljs-params">()</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">super</span>(Config.class);
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">()</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> apply(o -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">(Config config)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> (exchange, chain) -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ServerHttpResponse response = exchange.getResponse();

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//é’ˆå¯¹Responseçš„å„ç§å¤„ç†</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
&nbsp;&nbsp;&nbsp; }
}
</code></pre>

<p data-nodeid="723">PreGatewayFilter çš„å®ç°æ–¹å¼ä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡å¤„ç†çš„ç›®æ ‡ä¸€èˆ¬æ˜¯ ServerHttpRequest å¯¹è±¡ã€‚</p>

<p data-nodeid="724">ç›¸æ¯” Zuulï¼Œ<strong data-nodeid="848">è¯·æ±‚é™æµ</strong>æ˜¯ Spring Cloud Gateway çš„ä¸€é¡¹ç‰¹è‰²åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼Œ Spring Cloud Gateway ä¸­ä¸“é—¨å­˜åœ¨ä¸€ä¸ªè¯·æ±‚é™æµè¿‡æ»¤å™¨ RequestRateLimiterã€‚åœ¨ä»Šå¤©å†…å®¹çš„æœ€åï¼Œæˆ‘ä»¬ä¹Ÿå¯¹è¿™ä¸ªç‰¹æ®Šçš„è¿‡æ»¤å™¨åšä¸€äº›å±•å¼€ã€‚</p>

<p data-nodeid="725">æ‰€è°“é™æµï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯è¡¡é‡è¯·æ±‚å¤„ç†çš„é€Ÿç‡å¹¶å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚å› æ­¤ï¼ŒRequestRateLimiter æŠ½è±¡äº†ä¸¤ä¸ªå‚æ•°æ¥å®Œæˆè¿™ä¸€ç›®æ ‡ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ replenishRateï¼Œè¯¥å‚æ•°ç”¨äºæŒ‡å®šå…è®¸ç”¨æˆ·æ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°ã€‚è€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ burstCapacityï¼Œå®ƒè¢«ç”¨æ¥è®¾ç½®ä¸€ç§’é’Ÿå†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¯·æ±‚çœ‹æˆæ˜¯å¾€ä¸€ä¸ªæ¡¶é‡Œå€’æ°´ï¼Œé‚£ä¹ˆ replenishRate å‚æ•°ç”¨äºæ§åˆ¶æ°´æµçš„é€Ÿåº¦ï¼Œè€Œ burstCapacity ç”¨äºæ§åˆ¶æ¡¶çš„å¤§å°ã€‚è¯·æ±‚é™æµè¿‡æ»¤å™¨çš„å®Œæ•´é…ç½®ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre class="lang-xml" data-nodeid="726"><code data-language="xml">spring:
  cloud:
    gateway:
    &nbsp;&nbsp;&nbsp;routes:
    &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;- id: requestratelimiterroute
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uri: lb://interventionservice
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filters:
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;- name: RequestRateLimiter
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;args:
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;redis-rate-limiter.replenishRate: 50
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;redis-rate-limiter.burstCapacity: 100
</code></pre>

<p data-nodeid="727">è¯·æ±‚é™æµè¿‡æ»¤å™¨åœ¨å®ç°ä¸Šä¾èµ– Redisï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥ spring-boot-starter-data-redis-reactive è¿™ä¸ªæ”¯æŒå“åº”å¼ Redis çš„ä¾èµ–ã€‚ç„¶åæˆ‘ä»¬é’ˆå¯¹è®¿é—® ntervention-service çš„åœºæ™¯ï¼ŒåŸºäº Redis åˆ†åˆ«è®¾ç½® replenishRate å’Œ burstCapacity å€¼ä¸º 50 å’Œ 100ã€‚ä½ å¯ä»¥åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­å°è¯•å»è°ƒæ•´è¿™äº›å‚æ•°ã€‚</p>

<h3 data-nodeid="728">å°ç»“ä¸é¢„å‘Š</h3>

<p data-nodeid="729">ä»Šå¤©çš„å†…å®¹å›´ç»• Spring Cloud Gateway å±•å¼€ï¼Œè¿™æ˜¯æˆ‘ä»¬è¯¾ç¨‹ä¸­ä»‹ç»çš„ç¬¬äºŒä¸ª API ç½‘å…³å®ç°æ–¹æ¡ˆã€‚ä¸ Zuul ç›¸æ¯”ï¼ŒSpring Cloud Gateway åœ¨æä¾›é«˜æ€§èƒ½çš„åŒæ—¶ä¹Ÿä¸°å¯Œäº†ä½œä¸º API ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ã€‚åœ¨æœ¬è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å¯¹ Spring Cloud Gateway ä¸­çš„åŸºæœ¬æ¶æ„ã€æœåŠ¡è·¯ç”±ä»¥åŠè¿‡æ»¤å™¨æœºåˆ¶è¿›è¡Œäº†è¯¦ç»†çš„æ¢è®¨ã€‚</p>

<p data-nodeid="730">è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šåœ¨ Spring Cloud Gatewayä¸­ï¼Œå¦‚æœæƒ³è¦ç»™æ¯ä¸ªè¯·æ±‚è·¯å¾„æ·»åŠ ä¸€ä¸ªå‰ç¼€æœ‰å“ªäº›å®ç°æ–¹æ³•ï¼Ÿ</p>

<p data-nodeid="731" class="">ä»ä¸‹ä¸€è¯¾æ—¶å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥æ–°ä¸»é¢˜çš„æ¢è®¨ï¼Œå³å¦‚ä½•åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¼•å…¥æœåŠ¡å®¹é”™çš„è®¾è®¡æ€æƒ³å’Œå®ç°æŠ€æœ¯ï¼Œè€Œåœ¨å…·ä½“åº”ç”¨è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å®¹é”™ä¸ API ç½‘å…³ä¹Ÿæœ‰ç´§å¯†çš„å…³è”ã€‚</p>

<hr />
<h3 id="_1">ç²¾é€‰è¯„è®º<a class="headerlink" href="#_1" title="Permanent link">î…—</a></h3>
<h5 id="3759">**3759ï¼š<a class="headerlink" href="#3759" title="Permanent link">î…—</a></h5>
<blockquote>
<p>åœ¨å¾®æœåŠ¡ä¸­æœåŠ¡ä¹‹é—´çš„è°ƒç”¨Tokenæ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Œè¿˜æœ‰å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯å¦‚ä½•è·å–ï¼Œæ¯ä¸ªæœåŠ¡ä¸­è‡ªå·±å»è§£ætokenè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯è¿˜æ˜¯è¿˜æœ‰å…¶ä»–æ›´å¥½çš„æ–¹æ¡ˆï¼Œè¿˜è¯·è€å¸ˆæŒ‡æ•™ã€‚</p>
</blockquote>
<h5 id="_2">**æ˜ï¼š<a class="headerlink" href="#_2" title="Permanent link">î…—</a></h5>
<blockquote>
<p>è¿™ä¹Ÿå¤ªç®€å•äº†å§â€¦â€¦ä¸èƒ½é¡ºä¾¿è®²è®²fluxå˜›ï¼Œä¸æ¯«æ²¡æœ‰æŒæ¡</p>
</blockquote>
<p>###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š</p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp; è¯¾æ—¶è¿˜æ˜¯é¢å‘å¤§ä¼—ï¼Œé€šè¿‡ä¸€äº›ç®€å•çš„æ¡ˆä¾‹ä»‹ç»å®Œæ•´çš„æŠ€æœ¯ä½“ç³»ã€‚å…³äºå“åº”å¼ç¼–ç¨‹æ–¹é¢çš„å†…å®¹ä¸åœ¨è¿™ä¸ªè¯¾ç¨‹é‡Œï¼Œåé¢æ‹‰å‹¾è¿™è¾¹ä¼šæœ‰å“åº”å¼ç¼–ç¨‹æ–¹é¢çš„ä¸“æ ï¼Œå¯ä»¥å…³æ³¨ä¸€ä¸‹</p>
</blockquote>
<h5 id="_3">**æ½®ï¼š<a class="headerlink" href="#_3" title="Permanent link">î…—</a></h5>
<blockquote>
<p>spring-cloud-starter-netflix-eureka-server å¥½åƒå’Œspring-cloud-starter-gatewayå†²çªã€‚ç”¨spring-cloud-starter-netflix-eureka-clientå°±æ²¡å†²çªäº†ã€‚</p>
</blockquote>
<p>###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š</p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp; eurekaå’Œgatewayåº”è¯¥æ˜¯ä¸å†²çªçš„ï¼Œç¡®è®¤ä¸€ä¸‹ç‰ˆæœ¬ï¼Œå¯ä»¥å†è¯•è¯•</p>
</blockquote>
<h5 id="_4">**æ–‡ï¼š<a class="headerlink" href="#_4" title="Permanent link">î…—</a></h5>
<blockquote>
<p>æƒ³é—®ä¸€ä¸‹ç½‘å…³å‰ä¸ºä»€ä¹ˆè¦é…ä¸€ä¸ªnginxï¼Ÿæˆ‘æœ‰ç§ ç½‘å…³å’ŒnginxåŠŸèƒ½é‡åˆçš„é”™è§‰ï¼ŒæœŸå¾…è€å¸ˆèƒ½å±•å¼€è®²è®²ğŸ˜€</p>
</blockquote>
<p>###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š</p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp; nginxæ›´å¤šæ˜¯è¯·æ±‚è½¬å‘ï¼Œæ²¡æœ‰ä¸šåŠ¡å¤„ç†åŠŸèƒ½çš„ï¼Œä¸€èˆ¬ç”¨ä½œå‰ç½®çš„è´Ÿè½½å‡è¡¡</p>
</blockquote>
<h5 id="_5">**å®‡ï¼š<a class="headerlink" href="#_5" title="Permanent link">î…—</a></h5>
<blockquote>
<p>spring cloud gatewayå‰è¾¹éœ€è¦å†åŠ ä¸ªnginxä½œä¸ºç½‘å…³å—ï¼Ÿ</p>
</blockquote>
<p>###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š</p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp; å¯¹çš„ï¼Œä¸€èˆ¬éƒ½ä¼šå‰ç½®Nginx</p>
</blockquote></article></body></html>